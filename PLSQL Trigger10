# step 1---> To Create the Table Employee
CREATE TABLE Employee (
    emp_id       NUMBER(5) PRIMARY KEY,
    dept_id      NUMBER(5),
    emp_name     VARCHAR2(50),
    DoJ          DATE,
    salary       NUMBER(10,2),
    commission   NUMBER(10,2),
    job_title    VARCHAR2(50)
);

SET SERVEROUTPUT ON;

CREATE OR REPLACE TRIGGER trg_check_salary
BEFORE UPDATE OF salary ON Employee
FOR EACH ROW
BEGIN
    IF :NEW.salary < :OLD.salary THEN
        RAISE_APPLICATION_ERROR(-20001, 'Error: Salary cannot be decreased!');
    END IF;
END;
/
-- Try to decrease salary
UPDATE Employee SET salary = 40000 WHERE emp_id = 101;

# step 2---> To Create the Table History
CREATE TABLE job_history (
    emp_id        NUMBER(5),
    old_job_title VARCHAR2(50),
    old_dept_id   NUMBER(5),
    start_date    DATE,
    end_date      DATE
);

CREATE OR REPLACE TRIGGER trg_job_history
AFTER UPDATE OF job_title ON Employee
FOR EACH ROW
BEGIN
    IF :OLD.job_title <> :NEW.job_title THEN
        INSERT INTO job_history (emp_id, old_job_title, old_dept_id, start_date, end_date)
        VALUES (:OLD.emp_id, :OLD.job_title, :OLD.dept_id, :OLD.DoJ, SYSDATE);
    END IF;
END;
/

-- Update the job title of an employee
UPDATE Employee
SET job_title = 'Senior Developer'
WHERE emp_id = 101;

SELECT * FROM job_history;


